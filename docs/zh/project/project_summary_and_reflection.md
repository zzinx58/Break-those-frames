---
title: Summary and Reflection | Wabibapujs
---

# 项目过程中的反思与总结

基本如下本项目架构演进情景下存在的问题所述。

# 目前仍存在的问题

- 未能有可供展示的可视化库作品示例。
- 基本如下架构演进存在的五点问题所述。

# 已识别出的优化项

- immutable 数据操作的意识。
- UserInputAttr 类型工具的使用。
- 对象的属性与行为分隔管理，并采用主从形式进行组合。

# 架构演进的可能性

## 架构演进需求的背景：

- 业界开源可视化库大多同时支持多种渲染上下文【Canvas、SVG、WebGL 等】，(一个原因是：WebGL 和 Canvas2D 的渲染上下文获取共用一个 HTMLCanvasElement 提供的接口)，其中大多接入 WebGL 的高渲染性能来增强的图形库应对复杂图形页面的绘制能力。

## 本项目架构演进情景下存在的问题：

- 扩展性强的设计需要开发主导者有一定先见。然而对于我们团队而言，没有人有可视化项目的相关经验，故而只能决定主要对 2D 绘图的相关 API 进行整合。对于其他渲染上下文的扩展，在 API 方面应该还是容易的，纯函数，用函数或者类继承分隔开即可。扩展性考虑较麻烦的地方在于 --- 用于 2D 绘图对象的对应属性，在 3D 场景下的可复用度如何。按概念来讲，正确操作下，高维转低维应该不会损失操作细节，但从低维到高维，缺失的细节不是一点半点，加上由于 3D 绘图的上手门槛和缺乏 3D 可视化经验，我们没有这个实力来兼容一个 3D 场景下绘图对象的所有细节，可以预见，在并入 3D 绘图能力时，现有架构还会有至少一次较大的代码改动。
- 实现插件架构。插件架构的通信有所了解，但对于我们想并入的其他库插件的行为不够了解、对于代码作用域范围（不是指 JS 全局和函数作用域，但或许也有关）的不清晰（因为互联网上也有相关信息的噪音，有实证）、以及互联网上关于这部分实现的信息对本项目而言不够，我们无法承担整合一个黑盒进入系统的风险，至少短时间是不行的。
- 本可视化库的主要作者的面向对象思维还出于刚入门较初级的阶段。本项目的第三版开发当中，主要参考了 Spritejs 可视化库的设计。从该库中较为容易看见的是其对绘图对象类别的抽象当中，将绘图对象属性和行为进行了分离。并采用的是一种属性和行为组合的主从存在形式。本项目与过去项目的区别在于，过去项目的关注点较为分散，团队需要与实现项目相关的多个领域进行交涉，从某角度上看，这些交涉是不稳定的，会随需求需要而不断变动。而本项目赛道的难点我认为在于需要开发者对代码间逻辑结构有较高的把控能力、面向对象的抽象层次，个人开发过程中的感觉是更为纯粹了，虽然在实现优雅代码的过程中有所阻力，但能体验到很久未体验到的专注。正因为写纯粹代码层面的训练欠缺，所以理解其他开源库的作品的设计思路也是花了些时间。
- Spritejs 是一款小巧而强大的可视化库，应该是一个不错的源码学习案例。但该可视化库年代略为久远，存在一些 JS 语言的历史遗留问题，如没有 类中 protected 和私域 private 等字段。库作者针对此问题是使用了 Symbol.for 和 Symbol 来实现类属性私有和方法在类之间的转移和继承等效果。个人是采用了瀑布式迭代的方式进行开发（开发实践经验不足，良好的开发模式也是需要一定经验做支撑的，也是后来判断之前开发的方式像瀑布流，这大概不能算是一个好的开发模式，但由于没有相关项目经验，我需要代码带动我思考，最主要是带我在前期熟悉 Canvas 可视化相关 API。）在开发过程中，我愈发发现自己的对象属性的控制粒度过细，属性操作过于繁琐，如此明显以致于我决定停下自己的开发，重新开始研究市面上两款开源可视化库：G2、Sprite，其中 G2 的代码复杂度过高，层次分离过细，有较高学习成本，Spritejs 则更为清晰，小巧精简，遂作为主要学习对象，其属性行为的主从组合模式。但在学习过程中，我走岔两处了（一处是之后和库作者联系上后得知，Symbol 和 Symbol.for 在那时是为了解决 私域属性和类继承方法，而不是我以为的是出于库可扩展性，防止其他库行为影响本库对象属性的考虑，所以之后将代码中使用 Symbol 的方法实现和属性全部替换回了常规的现有支持字段）（另一处，Spritejs 的 Symbol.for 的方法继承跨越了属性和行为层，而我更改回 private、protected 之后，才发现这一点，属性层的必要方法我没法转移到行为层进行使用，我的类继承层次顺序出问题了，而这时离结项已经没有几天，遂决定躺平等死....），还有一个现在仍然有疑惑的知识点（Attr 属性类 的动态实例化，这点实现得有些过于巧妙，但这巧妙在 TS 上下文中给我带来了不少的理解成本，即使不在 TS 上下文也存在较大理解成本，似乎是涉及到原型链，但关于此我能前进着手思考的着陆点实在太少）。
- TS 上下文下，对方法和作为入参的对象类型的考虑要求比只是 JS 上下文要严苛不少，工作量较大，但也促使我更进一步学习了 TS，工具函数 Recored、Partial、Pick、Omit 等等的使用，都是在本次项目中学习得到。而这些工具函数，在过去接触较多的常规项目中，想来是很难接触到的。

### 项目架构演进问题基本总结五点：

- TS 类型安全的支持。
- 因较多模仿 Spritejs 实现，而继承而来的 JS 语言遗留问题。
- 本项目库因主要开发者的面向对象技术和抽象水平问题所遗留的不合理类继承与组合问题。
- 对扩展性开放对象行为的不了解问题。
- 对 3D 可视化 API 与数据结构、操作对象等知识点的不了解问题。
